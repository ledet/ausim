<?xml version="1.0" encoding="UTF-8"?>
<project name="Simulink2SysML" default="Sim2Sys">
	<property name="atl.launcher" value="Regular VM (with debugger)"/>
	<property name="rootModelName" value="Team_1_Strategy" />
	<property name="modelName" value="Team_1_Strategy" />
	<property name="metaModelPath" value="../MetaModels" />
	<property name="modelPath" value="../Models/" />
	<property name="transPath" value="../Transformations" />

	<target name="Sim2Sys">
		<taskdef name="atl.loadModel" classname="org.eclipse.m2m.atl.core.ant.tasks.LoadModelTask" />
        <taskdef name="atl.launch" classname="org.eclipse.m2m.atl.core.ant.tasks.ATLModelTransformationTask" />
        <taskdef name="atl.saveModel" classname="org.eclipse.m2m.atl.core.ant.tasks.SaveModelTask" />

		<unzip src="${modelPath}/${rootModelName}/${modelName}.slx" dest="${modelPath}/${rootModelName}/${modelName}_slx" />

		<xslt style="${transPath}/XSLT/Simulink_Settings.xsl"
			in="${modelPath}/${rootModelName}/${modelName}_slx/simulink/blockdiagram.xml"
			out="${modelPath}/${rootModelName}/${modelName}/Simulink_Settings.xmi"
			force="true">
		</xslt>

		<xslt style="${transPath}/XSLT/Simulink_Structural.xsl"
			in="${modelPath}/${rootModelName}/${modelName}_slx/simulink/blockdiagram.xml"
			out="${modelPath}/${rootModelName}/${modelName}/Simulink_Structural.xmi"
			force="true">
			<param name="ModelName" expression="${modelName}"/>
		</xslt>

		<atl.loadModel name="Source" metamodel="MOF" path="${metaModelPath}/SimulinkSourceMM.ecore"/>
    	<atl.loadModel name="Simulink" metamodel="MOF" path="${metaModelPath}/SimulinkMM.ecore"/>
		<atl.loadModel name="SysML" metamodel="MOF" nsUri="http://www.eclipse.org/papyrus/0.7.0/SysML"/>
		<atl.loadModel name="SysMLprof" metamodel="MOF" nsUri="http://www.eclipse.org/papyrus/0.7.0/SysML"/>
		<atl.loadModel name="SysMLnot" metamodel="MOF" nsUri="http://www.eclipse.org/gmf/runtime/1.0.2/notation"/>
    	<atl.loadModel name="SysMLProfiles" metamodel="SysMLprof" path="${modelPath}/BasicInformation/SimpleSysML.uml"/>
    	<atl.loadModel name="SysMLNotationDefinitions" metamodel="SysMLnot" path="${modelPath}/BasicInformation/SimpleSysML.notation"/>
    	<atl.loadModel name="simModel" metamodel="Simulink" path="${modelPath}/${rootModelName}/${modelName}/Simulink_Structural.xmi"/>
		
		<atl.launch path="${transPath}/ATL/Simulink2SourceDefaults.asm">
			<inmodel name="sim" model="simModel"/>
			<outmodel name="src" model="srcDef" metamodel="Source"/>
		</atl.launch>
		
		<atl.launch path="${transPath}/ATL/Simulink2Source.asm">
			<inmodel name="sim" model="simModel"/>
			<inmodel name="defaults" model="srcDef"/>
			<outmodel name="src" model="srcModel" metamodel="Source"/>
		</atl.launch>
		
		<atl.launch path="${transPath}/ATL/Source2SourceWPorts.asm">
			<inmodel name="src" model="srcModel"/>
			<outmodel name="srcwports" model="srcModelWPorts" metamodel="Source"/>
		</atl.launch>

		<atl.launch path="${transPath}/ATL/Source2SourceWConnections.asm">
			<inmodel name="src" model="srcModelWPorts"/>
			<inmodel name="simLines" model="simModel"/>
			<outmodel name="srcwcon" model="srcModelWConnections" metamodel="Source"/>
		</atl.launch>

		<atl.launch path="${transPath}/ATL/Source2SourceCompressed.asm">
			<inmodel name="src" model="srcModelWConnections"/>
			<outmodel name="srccomp" model="srcModelCompressed" metamodel="Source"/>
		</atl.launch>

		<atl.launch path="${transPath}/ATL/SourcePropertyTypes2SysMLTypes.asm">
			<inmodel name="src" model="srcModelCompressed"/>
			<outmodel name="prop" model="sysMLTypes" metamodel="SysML"/>
		</atl.launch>

		<atl.launch path="${transPath}/ATL/Source2SysML.asm">
			<option name="allowInterModelReferences" value="true"/>
			<inmodel name="src" model="srcModelCompressed"/>
			<inmodel name="prop" model="sysMLTypes"/>
			<inmodel name="prof" model="SysMLProfiles"/>
			<inmodel name="notDef" model="SysMLNotationDefinitions"/>
			<outmodel name="uml" model="SysMLModel" metamodel="SysML"/>
			<outmodel name="nota" model="SysMLNotation" metamodel="SysMLnot"/>
		</atl.launch>

		<atl.saveModel model="SysMLModel" path="${modelPath}/${rootModelName}/${modelName}/${modelName}.uml"/>
		<atl.saveModel model="SysMLNotation" path="${modelPath}/${rootModelName}/${modelName}/${modelName}.notation"/>

		<xslt style="${transPath}/XSLT/SysMLFinalizeUML.xsl"
			in="${modelPath}/${rootModelName}/${modelName}/${modelName}.uml"
			out="${modelPath}/${rootModelName}/SysML/${modelName}.uml"
			force="true">
		</xslt>

		<xslt style="${transPath}/XSLT/SysMLFinalizeNotation.xsl"
			in="${modelPath}/${rootModelName}/${modelName}/${modelName}.notation"
			out="${modelPath}/${rootModelName}/SysML/${modelName}.notation"
			force="true">
		</xslt>

		<xslt style="${transPath}/XSLT/SysMLFinalizeDI.xsl"
			in="${modelPath}/${rootModelName}/SysML/${modelName}.notation"
			out="${modelPath}/${rootModelName}/SysML/${modelName}.di"
			force="true">
			<param name="ModelName" expression="${modelName}"/>
		</xslt>

		<delete dir="${modelPath}/${rootModelName}/${modelName}_slx" />
		<delete file="${modelPath}/${rootModelName}/${modelName}/Simulink_Structural.xmi" />
		<delete file="${modelPath}/${rootModelName}/${modelName}/${modelName}.notation" />
		<delete file="${modelPath}/${rootModelName}/${modelName}/${modelName}.uml" />
	</target>
	
</project>